<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Resume Builder Mini App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Telegram Web App -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <!-- jsPDF –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

  <!-- –®—Ä–∏—Ñ—Ç—ã -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap"
    rel="stylesheet"
  />

  <style>
    :root {
      --bg:#0f111a;
      --card:#1f2337;
      --card-alt:#292e4f;
      --text:#f0f2fa;
      --muted:#8a94b0;
      --radius:14px;
      --shadow:0 20px 60px -10px rgba(15,17,26,.55);
      --accent:#6366f1;
      --transition:.45s cubic-bezier(.25,.8,.25,1);
      --gap:1.25rem;
    }
    *{box-sizing:border-box;}
    body {
      margin:0;
      font-family:'Inter',system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
      background: linear-gradient(135deg,#0f111a 0%,#1d223e 70%);
      color: var(--text);
      min-height:100vh;
      -webkit-font-smoothing:antialiased;
      position:relative;
      padding-bottom:80px;
    }
    .app {
      max-width: 1100px;
      margin: 0 auto;
      padding: 1rem 1rem 4rem;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:2rem;
    }
    h1 {
      font-size:2rem;
      margin:0 0 .5rem;
      font-weight:700;
      line-height:1.1;
    }
    h2 {
      font-size:1.1rem;
      margin:0 0 .5rem;
      font-weight:600;
      text-transform:uppercase;
      letter-spacing:1px;
    }
    p {margin:0 0 1rem; line-height:1.5;}
    .panel {
      background: var(--card);
      border-radius: var(--radius);
      padding:1.5rem;
      position:relative;
      overflow:hidden;
      box-shadow: var(--shadow);
      display:flex;
      flex-direction:column;
      gap:1rem;
      transform:translateY(0);
      transition: var(--transition);
    }
    .panel small {
      display:block;
      margin-bottom:6px;
      color: var(--muted);
    }
    .tagline {
      display:flex;
      flex-wrap:wrap;
      gap:.5rem;
    }
    .btn {
      display:inline-flex;
      align-items:center;
      gap:6px;
      cursor:pointer;
      border:none;
      padding:.7rem 1.2rem;
      border-radius:8px;
      font-weight:600;
      background: var(--accent);
      color:#fff;
      position:relative;
      overflow:hidden;
      transition: .3s ease;
    }
    .btn:hover {
      filter:brightness(1.05);
    }
    .btn-secondary {
      background: rgba(255,255,255,.07);
      color: var(--text);
    }
    .flex {display:flex; gap:1rem; flex-wrap:wrap;}
    .input {
      background: rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.1);
      padding:.75rem 1rem;
      border-radius:8px;
      width:100%;
      font-size:.95rem;
      color: var(--text);
      outline:none;
      transition: .2s ease;
    }
    .input:focus {
      border-color: var(--accent);
      box-shadow:0 0 16px rgba(99,102,241,.35);
    }
    .pill {
      background: rgba(255,255,255,.08);
      padding:6px 12px;
      border-radius:999px;
      font-size:.65rem;
      display:inline-block;
      margin-right:6px;
      margin-bottom:4px;
    }
    .stepper {
      display:flex;
      gap:.5rem;
      margin-bottom:1rem;
    }
    .step-dot {
      flex:1;
      background: rgba(255,255,255,.08);
      height:6px;
      border-radius:3px;
      position:relative;
      overflow:hidden;
    }
    .step-dot.active {
      background: var(--accent);
      box-shadow:0 0 12px rgba(99,102,241,.6);
    }
    .card {
      background: var(--card-alt);
      border-radius:12px;
      padding:1rem;
      position:relative;
      overflow:hidden;
      transition: var(--transition);
    }
    .section-wrapper {
      border:1px solid rgba(255,255,255,.08);
      border-radius:10px;
      padding:1rem;
      position:relative;
      margin-bottom:1rem;
      overflow:hidden;
    }
    .section-actions {
      display:flex;
      gap:.5rem;
      flex-wrap:wrap;
      margin-top:4px;
    }
    .small-btn {
      background: rgba(255,255,255,.06);
      border:none;
      padding:6px 10px;
      border-radius:6px;
      cursor:pointer;
      font-size:.75rem;
      color: var(--text);
      display:inline-flex;
      align-items:center;
      gap:4px;
      transition:.2s;
    }
    .small-btn:hover {
      background: rgba(255,255,255,.1);
    }
    .template-switcher {
      display:flex;
      gap:8px;
      margin-bottom:1rem;
      flex-wrap:wrap;
    }
    .template-card {
      flex:1;
      background: rgba(255,255,255,.03);
      padding:10px 14px;
      border-radius:8px;
      cursor:pointer;
      position:relative;
      border:2px solid transparent;
      transition:.25s;
      min-width:120px;
      display:flex;
      align-items:center;
      gap:10px;
    }
    .template-card.selected {
      border-color: var(--accent);
      box-shadow:0 0 20px rgba(99,102,241,.4);
    }
    .preview-wrapper {
      background:#0f111a;
      border:1px solid rgba(255,255,255,.07);
      border-radius:12px;
      padding:1rem;
      position:relative;
      overflow:auto;
    }
    .resume {
      background:#fff;
      color:#1e2432;
      border-radius:10px;
      padding:24px 28px;
      max-width:800px;
      margin:auto;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
      position:relative;
      overflow:hidden;
      transform:scale(.98);
      transition:.3s;
    }
    .resume-header {
      display:flex;
      justify-content:space-between;
      flex-wrap:wrap;
      gap:10px;
    }
    .name-block {
      flex:1;
    }
    .name-block h1 {
      margin:0;
      font-size:1.9rem;
      line-height:1.1;
    }
    .title {
      margin-top:4px;
      font-weight:600;
      color:#555;
    }
    .contact {
      text-align:right;
      font-size:.75rem;
      line-height:1.3;
      flex:1;
    }
    .section-title {
      margin:0;
      font-weight:700;
      display:flex;
      align-items:center;
      gap:8px;
      font-size:1rem;
      margin-bottom:6px;
    }
    .line {
      height:3px;
      width:50px;
      background: var(--accent);
      border-radius:2px;
    }
    .item {
      margin-bottom:12px;
    }
    .muted {
      color:#777;
    }
    .skill-badge {
      display:inline-block;
      background:#eef2f7;
      color:#444;
      padding:6px 12px;
      border-radius:999px;
      font-size:.65rem;
      margin:2px 4px 4px 0;
    }
    .fade-in {
      opacity:0;
      transform:translateY(6px);
      animation:appear .7s forwards;
    }
    @keyframes appear {
      to {opacity:1; transform:translateY(0);}
    }

    /* Responsive */
    @media (max-width:1100px){
      .app{grid-template-columns:1fr;}
    }

    /* Tooltip */
    .tooltip {
      position:relative;
      cursor:help;
    }
    .tooltip .tip {
      position:absolute;
      top:-6px;
      right:100%;
      background:rgba(0,0,0,.85);
      padding:6px 10px;
      border-radius:6px;
      font-size:.6rem;
      white-space:nowrap;
      transform:translateX(-6px);
      z-index:5;
      opacity:0;
      pointer-events:none;
      transition:.2s;
      color:#fff;
    }
    .tooltip:hover .tip {
      opacity:1;
    }

    .pill-theme {
      display:inline-block;
      padding:6px 14px;
      background: rgba(255,255,255,.04);
      border-radius:999px;
      font-size:.6rem;
      margin-right:4px;
    }

    .notification {
      position:fixed;
      top:16px;
      right:16px;
      background:rgba(99,102,241,.95);
      color:#fff;
      padding:12px 18px;
      border-radius:8px;
      box-shadow:0 30px 60px -10px rgba(99,102,241,.5);
      display:flex;
      gap:8px;
      align-items:center;
      font-size:.9rem;
      z-index:100;
      opacity:0;
      pointer-events:none;
      transition:.3s;
    }
    .notification.show {
      opacity:1;
      pointer-events:auto;
    }
    .theme-toggle {
      background: rgba(255,255,255,.07);
      border:none;
      padding:8px 12px;
      border-radius:8px;
      cursor:pointer;
      font-size:.9rem;
      display:inline-flex;
      align-items:center;
      gap:6px;
      color: var(--text);
      margin-left:auto;
    }
    .tagline span {
      position:relative;
      display:inline-block;
      overflow:hidden;
    }
    .pulse {
      animation:pulse 3s ease-in-out infinite;
    }
    @keyframes pulse {
      0% {transform:scale(1);}
      50% {transform:scale(1.02);}
      100% {transform:scale(1);}
    }
  </style>
</head>
<body>
  <!-- Notification -->
  <div id="notif" class="notification" aria-live="polite"></div>

  <div class="app">
    <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å: —Ä–µ–¥–∞–∫—Ç–æ—Ä -->
    <div class="panel" aria-label="–†–µ–¥–∞–∫—Ç–æ—Ä —Ä–µ–∑—é–º–µ">
      <div style="display:flex; gap:8px; align-items:center;">
        <div>
          <h1>–†–µ–∑—é–º–µ</h1>
          <div class="tagline">
            <span>–°–æ–∑–¥–∞–π –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ä–µ–∑—é–º–µ</span>
            <span class="pill">–ë–µ–∑ –±—ç–∫–∞</span>
            <span class="pill">–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ</span>
            <span class="pill">PDF —ç–∫—Å–ø–æ—Ä—Ç</span>
          </div>
        </div>
        <button class="theme-toggle" id="telegram-ready" title="–¢–µ–ª–µ–≥—Ä–∞–º WebApp –≥–æ—Ç–æ–≤">üì¶ Telegram</button>
      </div>

      <!-- –°—Ç–µ–ø–ø–µ—Ä -->
      <div class="stepper" aria-label="–ü—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è">
        <div class="step-dot" data-step-index="0"></div>
        <div class="step-dot" data-step-index="1"></div>
        <div class="step-dot" data-step-index="2"></div>
        <div class="step-dot" data-step-index="3"></div>
        <div class="step-dot" data-step-index="4"></div>
      </div>

      <!-- –í—ã–±–æ—Ä —à–∞–±–ª–æ–Ω–∞ -->
      <div class="template-switcher" aria-label="–í—ã–±–æ—Ä —à–∞–±–ª–æ–Ω–∞">
        <div class="template-card selected" data-template="default">
          <div style="flex:1;">
            <strong>–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π</strong>
            <div style="font-size:.65rem; margin-top:4px;">–ú–∏–Ω–∏–º–∞–ª, —Å–≤–µ—Ç–ª—ã–π –∞–∫—Ü–µ–Ω—Ç</div>
          </div>
        </div>
        <div class="template-card" data-template="modern">
          <div style="flex:1;">
            <strong>–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π</strong>
            <div style="font-size:.65rem; margin-top:4px;">–ö–æ–Ω—Ç—Ä–∞—Å—Ç–Ω—ã–π, –∞–∫—Ü–µ–Ω—Ç</div>
          </div>
        </div>
      </div>

      <!-- –§–æ—Ä–º–∞ -->
      <div id="form-area">
        <!-- –ü—Ä–æ—Ñ–∏–ª—å -->
        <div class="section-wrapper" data-step="0">
          <div class="section-title">
            <div class="line"></div><div>–ü—Ä–æ—Ñ–∏–ª—å</div>
          </div>
          <div class="flex">
            <div style="flex:1;">
              <small>–ò–º—è –∏ —Ñ–∞–º–∏–ª–∏—è</small>
              <input class="input" type="text" id="fullName" placeholder="–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤" />
            </div>
            <div style="flex:1;">
              <small>–î–æ–ª–∂–Ω–æ—Å—Ç—å / –∑–∞–≥–æ–ª–æ–≤–æ–∫</small>
              <input class="input" type="text" id="title" placeholder="Frontend —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫" />
            </div>
          </div>
          <div class="flex">
            <div style="flex:1;">
              <small>Email</small>
              <input class="input" type="email" id="email" placeholder="ivan@example.com" />
            </div>
            <div style="flex:1;">
              <small>–¢–µ–ª–µ—Ñ–æ–Ω</small>
              <input class="input" type="text" id="phone" placeholder="+7 912 345-67-89" />
            </div>
          </div>
        </div>

        <!-- –û —Å–µ–±–µ -->
        <div class="section-wrapper" data-step="1">
          <div class="section-title">
            <div class="line"></div><div>–û —Å–µ–±–µ</div>
          </div>
          <textarea
            class="input"
            id="summary"
            rows="4"
            placeholder="–ö—Ä–∞—Ç–∫–æ–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ. –ü—Ä–∏–º–µ—Ä: –û–ø—ã—Ç–Ω—ã–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ —Å 5+ –ª–µ—Ç –≤ —Å–æ–∑–¥–∞–Ω–∏–∏ –±—ã—Å—Ç—Ä—ã—Ö –∏ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤."
          ></textarea>
        </div>

        <!-- –û–ø—ã—Ç -->
        <div class="section-wrapper" data-step="2">
          <div class="section-title">
            <div class="line"></div><div>–û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã</div>
          </div>
          <div id="experience-list"></div>
          <div class="section-actions">
            <button class="small-btn" id="add-experience">+ –î–æ–±–∞–≤–∏—Ç—å –æ–ø—ã—Ç</button>
            <div class="pill-theme">–ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–π, —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π, —É–¥–∞–ª—è–π</div>
          </div>
        </div>

        <!-- –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∏ –Ω–∞–≤—ã–∫–∏ -->
        <div class="section-wrapper" data-step="3">
          <div class="section-title">
            <div class="line"></div><div>–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ</div>
          </div>
          <div id="education-list"></div>
          <div class="section-actions">
            <button class="small-btn" id="add-education">+ –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ</button>
          </div>

          <div style="margin-top:1.5rem;">
            <div class="section-title">
              <div class="line"></div><div>–ù–∞–≤—ã–∫–∏</div>
            </div>
            <div id="skills-list" style="display:flex; flex-wrap:wrap; gap:6px;"></div>
            <div style="margin-top:6px; display:flex; gap:8px; flex-wrap:wrap;">
              <input class="input" style="flex:1; min-width:140px;" id="new-skill" placeholder="–ù–æ–≤–∞—è –Ω–∞–≤—ã–∫ (–Ω–∞–ø—Ä. JavaScript)" />
              <button class="small-btn" id="add-skill">–î–æ–±–∞–≤–∏—Ç—å</button>
            </div>
          </div>
        </div>

        <!-- –ü—Ä–æ–µ–∫—Ç—ã -->
        <div class="section-wrapper" data-step="4">
          <div class="section-title">
            <div class="line"></div><div>–ü—Ä–æ–µ–∫—Ç—ã</div>
          </div>
          <div id="projects-list"></div>
          <div class="section-actions">
            <button class="small-btn" id="add-project">+ –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–µ–∫—Ç</button>
          </div>
        </div>
      </div>

      <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ -->
      <div style="margin-top:8px; display:flex; flex-wrap:wrap; gap:10px; align-items:center;">
        <div style="flex:1; min-width:220px;">
          <button class="btn" id="save-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
          <button class="btn btn-secondary" id="load-btn">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
        </div>
        <div style="margin-left:auto; display:flex; gap:8px; flex-wrap:wrap;">
          <button class="btn" id="preview-btn">–ü—Ä–µ–≤—å—é</button>
          <button class="btn" id="export-pdf-btn">–≠–∫—Å–ø–æ—Ä—Ç –≤ PDF</button>
          <button class="btn btn-secondary" id="reset-btn">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë</button>
        </div>
      </div>

      <div style="margin-top:8px; font-size:.8rem; color:rgba(255,255,255,.7);">
        –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ. –ú–æ–∂–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É –≤ Telegram —á–µ—Ä–µ–∑ WebApp API.
      </div>
    </div>

    <!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å: –∂–∏–≤–æ–µ –ø—Ä–µ–≤—å—é -->
    <div class="panel" aria-label="–ü—Ä–µ–≤—å—é —Ä–µ–∑—é–º–µ">
      <div style="display:flex; gap:8px; align-items:center; margin-bottom:6px;">
        <div>
          <h2>–ü—Ä–µ–≤—å—é</h2>
          <div style="font-size:.75rem; color: var(--muted);">–û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</div>
        </div>
        <div style="margin-left:auto;">
          <div class="pill">–®–∞–±–ª–æ–Ω: <span id="current-template">–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π</span></div>
        </div>
      </div>
      <div class="preview-wrapper" id="preview-container" aria-live="polite">
        <!-- –†–µ–Ω–¥–µ—Ä —Ä–µ–∑—é–º–µ —Å—é–¥–∞ -->
        <div id="resume-render" class="resume">
          <!-- –Ω–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ JS -->
        </div>
      </div>
    </div>
  </div>

  <script>
    // ==================== UTILS ====================
    function uuid() {
      return crypto.randomUUID?.() || Math.random().toString(36).substring(2,9);
    }
    function showNotification(msg, duration = 2000) {
      const n = document.getElementById('notif');
      n.textContent = msg;
      n.classList.add('show');
      setTimeout(()=> n.classList.remove('show'), duration);
    }
    function getData() {
      const d = localStorage.getItem('resume_builder_data');
      if (!d) return defaultData();
      try { return JSON.parse(d); } catch { return defaultData(); }
    }
    function saveData(data) {
      localStorage.setItem('resume_builder_data', JSON.stringify(data));
    }
    function defaultData() {
      return {
        profile: {
          fullName: '',
          title: '',
          email: '',
          phone: ''
        },
        summary: '',
        experience: [],
        education: [],
        skills: [],
        projects: [],
        template: 'default'
      };
    }

    // ==================== Telegram WebApp init ====================
    if (window.Telegram?.WebApp) {
      window.Telegram.WebApp.ready();
      document.getElementById('telegram-ready').textContent = 'Telegram ‚úî';
      document.getElementById('telegram-ready').addEventListener('click', () => {
        // –ü—Ä–∏–º–µ—Ä: –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –±–æ—Ç–∞
        const data = getData();
        window.Telegram.WebApp.sendData(JSON.stringify({ resume: data }));
        showNotification('–î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ Telegram WebApp'); // –Ω—É–∂–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ –±—ç–∫–µ –±–æ—Ç–∞
      });
    }

    // ==================== STATE ====================
    let state = getData();

    // –≠–ª–µ–º–µ–Ω—Ç—ã
    const fullNameEl = document.getElementById('fullName');
    const titleEl = document.getElementById('title');
    const emailEl = document.getElementById('email');
    const phoneEl = document.getElementById('phone');
    const summaryEl = document.getElementById('summary');
    const experienceListEl = document.getElementById('experience-list');
    const educationListEl = document.getElementById('education-list');
    const skillsListEl = document.getElementById('skills-list');
    const projectsListEl = document.getElementById('projects-list');
    const resumeRenderEl = document.getElementById('resume-render');
    const currentTemplateLabel = document.getElementById('current-template');

    // ==================== INIT ====================
    function init() {
      loadIntoForm();
      renderDynamicSections();
      renderPreview();
      setupEventListeners();
      updateStepper();
      applyTemplateVisual();
    }

    function loadIntoForm() {
      fullNameEl.value = state.profile.fullName;
      titleEl.value = state.profile.title;
      emailEl.value = state.profile.email;
      phoneEl.value = state.profile.phone;
      summaryEl.value = state.summary;
      currentTemplateLabel.textContent = templateName(state.template);
    }

    function setupEventListeners() {
      // –ü—Ä–æ—Ñ–∏–ª—å
      [fullNameEl, titleEl, emailEl, phoneEl].forEach(el => {
        el.addEventListener('input', () => {
          state.profile.fullName = fullNameEl.value;
          state.profile.title = titleEl.value;
          state.profile.email = emailEl.value;
          state.profile.phone = phoneEl.value;
          persist();
          renderPreview();
        });
      });
      summaryEl.addEventListener('input', () => {
        state.summary = summaryEl.value;
        persist();
        renderPreview();
      });

      // –î–æ–±–∞–≤–∏—Ç—å –æ–ø—ã—Ç
      document.getElementById('add-experience').addEventListener('click', () => {
        state.experience.push({
          id: uuid(),
          company: '',
          position: '',
          start: '',
          end: '',
          description: ''
        });
        persist();
        renderDynamicSections();
        renderPreview();
        showNotification('–î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π –æ–ø—ã—Ç');
      });

      // –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ
      document.getElementById('add-education').addEventListener('click', () => {
        state.education.push({
          id: uuid(),
          school: '',
          degree: '',
          start: '',
          end: '',
          extra: ''
        });
        persist();
        renderDynamicSections();
        renderPreview();
        showNotification('–î–æ–±–∞–≤–ª–µ–Ω–æ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ');
      });

      // –ù–∞–≤—ã–∫–∏
      document.getElementById('add-skill').addEventListener('click', () => {
        const input = document.getElementById('new-skill');
        const val = input.value.trim();
        if (val) {
          if (!state.skills.includes(val)) {
            state.skills.push(val);
            persist();
            renderDynamicSections();
            renderPreview();
            showNotification('–ù–∞–≤—ã–∫ –¥–æ–±–∞–≤–ª–µ–Ω');
          } else showNotification('–¢–∞–∫–æ–π –Ω–∞–≤—ã–∫ —É–∂–µ –µ—Å—Ç—å');
          input.value = '';
        }
      });

      // –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–µ–∫—Ç
      document.getElementById('add-project').addEventListener('click', () => {
        state.projects.push({
          id: uuid(),
          name: '',
          description: '',
          link: ''
        });
        persist();
        renderDynamicSections();
        renderPreview();
        showNotification('–î–æ–±–∞–≤–ª–µ–Ω –ø—Ä–æ–µ–∫—Ç');
      });

      // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å / –ó–∞–≥—Ä—É–∑–∏—Ç—å / –°–±—Ä–æ—Å
      document.getElementById('save-btn').addEventListener('click', () => {
        persist();
        showNotification('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ');
      });
      document.getElementById('load-btn').addEventListener('click', () => {
        state = getData();
        loadIntoForm();
        renderDynamicSections();
        renderPreview();
        showNotification('–ó–∞–≥—Ä—É–∂–µ–Ω–æ');
      });
      document.getElementById('reset-btn').addEventListener('click', () => {
        if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ?')) {
          state = defaultData();
          persist();
          loadIntoForm();
          renderDynamicSections();
          renderPreview();
          showNotification('–°–±—Ä–æ—à–µ–Ω–æ');
        }
      });

      // –ü—Ä–µ–≤—å—é –∏ PDF
      document.getElementById('preview-btn').addEventListener('click', () => {
        renderPreview(true);
      });
      document.getElementById('export-pdf-btn').addEventListener('click', exportPDF);

      // –®–∞–±–ª–æ–Ω—ã
      document.querySelectorAll('.template-card').forEach(card => {
        card.addEventListener('click', () => {
          const t = card.getAttribute('data-template');
          state.template = t;
          persist();
          applyTemplateVisual();
          renderPreview();
          currentTemplateLabel.textContent = templateName(t);
          showNotification('–®–∞–±–ª–æ–Ω –∏–∑–º–µ–Ω—ë–Ω');
        });
      });
    }

    function templateName(key) {
      return key === 'modern' ? '–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π' : '–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π';
    }

    function applyTemplateVisual() {
      document.querySelectorAll('.template-card').forEach(c => {
        c.classList.toggle('selected', c.getAttribute('data-template') === state.template);
      });
    }

    function persist() {
      saveData(state);
    }

    // ==================== –†–µ–Ω–¥–µ—Ä –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö —Å–µ–∫—Ü–∏–π ====================
    function renderDynamicSections() {
      // –û–ø—ã—Ç
      experienceListEl.innerHTML = '';
      state.experience.forEach(exp => {
        const el = document.createElement('div');
        el.className = 'section-wrapper';
        el.dataset.id = exp.id;
        el.innerHTML = `
          <div style="display:flex; justify-content:space-between; align-items:center;">
            <div class="section-title"><div class="line"></div><div>–û–ø—ã—Ç</div></div>
            <div style="display:flex; gap:6px;">
              <button class="small-btn remove-exp" title="–£–¥–∞–ª–∏—Ç—å">–£–¥–∞–ª–∏—Ç—å</button>
            </div>
          </div>
          <div class="flex" style="gap:10px; flex-wrap:wrap;">
            <div style="flex:1; min-width:150px;">
              <small>–ö–æ–º–ø–∞–Ω–∏—è</small>
              <input class="input exp-company" value="${escapeHtml(exp.company)}" placeholder="Acme Corp" />
            </div>
            <div style="flex:1; min-width:150px;">
              <small>–î–æ–ª–∂–Ω–æ—Å—Ç—å</small>
              <input class="input exp-position" value="${escapeHtml(exp.position)}" placeholder="Frontend dev" />
            </div>
          </div>
          <div class="flex" style="gap:10px; flex-wrap:wrap;">
            <div style="flex:1; min-width:120px;">
              <small>–°</small>
              <input class="input exp-start" type="month" value="${exp.start}" />
            </div>
            <div style="flex:1; min-width:120px;">
              <small>–ü–æ</small>
              <input class="input exp-end" type="month" value="${exp.end}" />
            </div>
          </div>
          <div>
            <small>–û–ø–∏—Å–∞–Ω–∏–µ</small>
            <textarea class="input exp-desc" rows="2" placeholder="–ß—Ç–æ –¥–µ–ª–∞–ª...">${escapeHtml(exp.description)}</textarea>
          </div>
        `;
        experienceListEl.appendChild(el);

        // —Å–ª—É—à–∞—Ç–µ–ª–∏
        el.querySelector('.exp-company').addEventListener('input', e => {
          exp.company = e.target.value;
          persist();
          renderPreview();
        });
        el.querySelector('.exp-position').addEventListener('input', e => {
          exp.position = e.target.value;
          persist();
          renderPreview();
        });
        el.querySelector('.exp-start').addEventListener('input', e => {
          exp.start = e.target.value;
          persist();
          renderPreview();
        });
        el.querySelector('.exp-end').addEventListener('input', e => {
          exp.end = e.target.value;
          persist();
          renderPreview();
        });
        el.querySelector('.exp-desc').addEventListener('input', e => {
          exp.description = e.target.value;
          persist();
          renderPreview();
        });
        el.querySelector('.remove-exp').addEventListener('click', () => {
          state.experience = state.experience.filter(x => x.id !== exp.id);
          persist();
          renderDynamicSections();
          renderPreview();
          showNotification('–û–ø—ã—Ç —É–¥–∞–ª—ë–Ω');
        });
      });

      // –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ
      educationListEl.innerHTML = '';
      state.education.forEach(ed => {
        const el = document.createElement('div');
        el.className = 'section-wrapper';
        el.dataset.id = ed.id;
        el.innerHTML = `
          <div style="display:flex; justify-content:space-between; align-items:center;">
            <div class="section-title"><div class="line"></div><div>–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ</div></div>
            <div style="display:flex; gap:6px;">
              <button class="small-btn remove-edu" title="–£–¥–∞–ª–∏—Ç—å">–£–¥–∞–ª–∏—Ç—å</button>
            </div>
          </div>
          <div class="flex" style="gap:10px; flex-wrap:wrap;">
            <div style="flex:1; min-width:150px;">
              <small>–£—á–µ–±–Ω–æ–µ –∑–∞–≤–µ–¥–µ–Ω–∏–µ</small>
              <input class="input edu-school" value="${escapeHtml(ed.school)}" placeholder="–£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç" />
            </div>
            <div style="flex:1; min-width:150px;">
              <small>–°—Ç–µ–ø–µ–Ω—å / –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å</small>
              <input class="input edu-degree" value="${escapeHtml(ed.degree)}" placeholder="–ë–∞–∫–∞–ª–∞–≤—Ä, CS" />
            </div>
          </div>
          <div class="flex" style="gap:10px; flex-wrap:wrap;">
            <div style="flex:1; min-width:120px;">
              <small>–°</small>
              <input class="input edu-start" type="month" value="${ed.start}" />
            </div>
            <div style="flex:1; min-width:120px;">
              <small>–ü–æ</small>
              <input class="input edu-end" type="month" value="${ed.end}" />
            </div>
          </div>
          <div>
            <small>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ</small>
            <input class="input edu-extra" value="${escapeHtml(ed.extra)}" placeholder="–°—Ç–∏–ø–µ–Ω–¥–∏—è, GPA –∏ —Ç.–ø." />
          </div>
        `;
        educationListEl.appendChild(el);

        // —Å–ª—É—à–∞—Ç–µ–ª–∏
        el.querySelector('.edu-school').addEventListener('input', e => {
          ed.school = e.target.value;
          persist();
          renderPreview();
        });
        el.querySelector('.edu-degree').addEventListener('input', e => {
          ed.degree = e.target.value;
          persist();
          renderPreview();
        });
        el.querySelector('.edu-start').addEventListener('input', e => {
          ed.start = e.target.value;
          persist();
          renderPreview();
        });
        el.querySelector('.edu-end').addEventListener('input', e => {
          ed.end = e.target.value;
          persist();
          renderPreview();
        });
        el.querySelector('.edu-extra').addEventListener('input', e => {
          ed.extra = e.target.value;
          persist();
          renderPreview();
        });
        el.querySelector('.remove-edu').addEventListener('click', () => {
          state.education = state.education.filter(x => x.id !== ed.id);
          persist();
          renderDynamicSections();
          renderPreview();
          showNotification('–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ');
        });
      });

      // –ù–∞–≤—ã–∫–∏
      skillsListEl.innerHTML = '';
      state.skills.forEach(s => {
        const badge = document.createElement('div');
        badge.className = 'skill-badge';
        badge.textContent = s;
        const rem = document.createElement('span');
        rem.style.marginLeft='6px';
        rem.style.cursor='pointer';
        rem.textContent='√ó';
        rem.title='–£–¥–∞–ª–∏—Ç—å';
        rem.addEventListener('click', () => {
          state.skills = state.skills.filter(x => x !== s);
          persist();
          renderDynamicSections();
          renderPreview();
          showNotification('–ù–∞–≤—ã–∫ —É–¥–∞–ª—ë–Ω');
        });
        badge.appendChild(rem);
        skillsListEl.appendChild(badge);
      });

      // –ü—Ä–æ–µ–∫—Ç—ã
      projectsListEl.innerHTML = '';
      state.projects.forEach(p => {
        const el = document.createElement('div');
        el.className = 'section-wrapper';
        el.dataset.id = p.id;
        el.innerHTML = `
          <div style="display:flex; justify-content:space-between; align-items:center;">
            <div class="section-title"><div class="line"></div><div>–ü—Ä–æ–µ–∫—Ç</div></div>
            <div style="display:flex; gap:6px;">
              <button class="small-btn remove-proj" title="–£–¥–∞–ª–∏—Ç—å">–£–¥–∞–ª–∏—Ç—å</button>
            </div>
          </div>
          <div>
            <small>–ù–∞–∑–≤–∞–Ω–∏–µ</small>
            <input class="input proj-name" value="${escapeHtml(p.name)}" placeholder="My Cool App" />
          </div>
          <div>
            <small>–û–ø–∏—Å–∞–Ω–∏–µ</small>
            <textarea class="input proj-desc" rows="2" placeholder="–ß—Ç–æ –¥–µ–ª–∞–µ—Ç, —Å—Ç–µ–∫">${escapeHtml(p.description)}</textarea>
          </div>
          <div>
            <small>–°—Å—ã–ª–∫–∞</small>
            <input class="input proj-link" value="${escapeHtml(p.link)}" placeholder="https://..." />
          </div>
        `;
        projectsListEl.appendChild(el);

        el.querySelector('.proj-name').addEventListener('input', e => {
          p.name = e.target.value;
          persist();
          renderPreview();
        });
        el.querySelector('.proj-desc').addEventListener('input', e => {
          p.description = e.target.value;
          persist();
          renderPreview();
        });
        el.querySelector('.proj-link').addEventListener('input', e => {
          p.link = e.target.value;
          persist();
          renderPreview();
        });
        el.querySelector('.remove-proj').addEventListener('click', () => {
          state.projects = state.projects.filter(x => x.id !== p.id);
          persist();
          renderDynamicSections();
          renderPreview();
          showNotification('–ü—Ä–æ–µ–∫—Ç —É–¥–∞–ª—ë–Ω');
        });
      });
    }

    // –ü—Ä–æ—Å—Ç–∞—è —ç–∫—Ä–∞–Ω–∏–∑–∞—Ü–∏—è –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ –≤ value / textContent
    function escapeHtml(str) {
      return String(str || '').replace(/[&<>"']/g, function(m){ return ({
        '&':'&amp;',
        '<':'&lt;',
        '>':'&gt;',
        '"':'&quot;',
        "'":'&#39;'
      })[m]; });
    }

    // ==================== –ü—Ä–µ–≤—å—é ====================
    function renderPreview(openBlank=false) {
      // –°–æ–±–∏—Ä–∞–µ–º HTML
      const tpl = buildResumeHTML(state);
      resumeRenderEl.innerHTML = tpl;

      // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —à–∞–±–ª–æ–Ω–∞ –≤–∏–∑—É–∞–ª—å–Ω–æ
      if (openBlank) {
        const w = window.open('');
        w.document.write(`
          <html>
            <head>
              <meta charset="UTF-8" />
              <title>–†–µ–∑—é–º–µ ‚Äî –ø—Ä–µ–≤—å—é</title>
              <meta name="viewport" content="width=device-width,initial-scale=1.0" />
              <style>
                body{margin:0;background:#f2f4f9;font-family:system-ui,-apple-system,BlinkMacSystemFont,sans-serif;padding:30px;}
                .resume{max-width:800px;margin:auto;background:#fff;border-radius:10px;box-shadow:0 40px 100px -20px rgba(0,0,0,.1);padding:30px;color:#1e2432;}
                .resume-header{display:flex;justify-content:space-between;flex-wrap:wrap;gap:10px;}
                .name-block h1{margin:0;font-size:1.9rem;line-height:1.1;}
                .title{margin-top:4px;font-weight:600;color:#555;}
                .contact{text-align:right;font-size:.75rem;line-height:1.3;flex:1;}
                .section-title{margin-top:24px;font-weight:700;display:flex;align-items:center;gap:8px;font-size:1rem;margin-bottom:6px;}
                .line{height:3px;width:50px;background:#6366f1;border-radius:2px;}
                .item{margin-bottom:12px;}
                .muted{color:#777;}
                .skill-badge{display:inline-block;background:#eef2f7;color:#444;padding:6px 12px;border-radius:999px;font-size:.65rem;margin:2px 4px 4px 0;}
                a{color:#6366f1;text-decoration:none;}
              </style>
            </head>
            <body>${tpl}</body>
          </html>
        `);
        w.document.close();
      }
    }

    function buildResumeHTML(data) {
      // Helper –¥–ª—è –¥–∞—Ç
      function formatPeriod(start, end) {
        if (!start && !end) return '';
        const opts = { year: 'numeric', month: 'short' };
        try {
          const s = start ? new Date(start + '-01').toLocaleDateString('ru-RU', opts) : '';
          const e = end ? new Date(end + '-01').toLocaleDateString('ru-RU', opts) : '–Ω–∞—Å—Ç–æ—è—â–µ–µ –≤—Ä–µ–º—è';
          return `${s} ‚Äî ${e}`;
        } catch { return `${start || ''} ‚Äî ${end || ''}`; }
      }

      // –°–æ–±–∏—Ä–∞–µ–º –∫—É—Å–∫–∏
      let experienceHTML = '';
      data.experience.forEach(exp => {
        if (!exp.company && !exp.position) return;
        experienceHTML += `
          <div class="item">
            <div style="display:flex; justify-content:space-between; flex-wrap:wrap;">
              <div>
                <div style="font-weight:600;">${escapeHtml(exp.position || '')} ${exp.position ? '–≤' : ''} ${escapeHtml(exp.company || '')}</div>
                <div class="muted" style="font-size:.75rem;">${formatPeriod(exp.start, exp.end)}</div>
              </div>
            </div>
            <div style="margin-top:4px;">${escapeHtml(exp.description || '')}</div>
          </div>
        `;
      });

      let educationHTML = '';
      data.education.forEach(ed => {
        if (!ed.school) return;
        educationHTML += `
          <div class="item">
            <div style="display:flex; justify-content:space-between; flex-wrap:wrap;">
              <div>
                <div style="font-weight:600;">${escapeHtml(ed.degree || '')} ‚Äî ${escapeHtml(ed.school || '')}</div>
                <div class="muted" style="font-size:.75rem;">${formatPeriod(ed.start, ed.end)}</div>
              </div>
            </div>
            ${ed.extra ? `<div style="margin-top:4px;">${escapeHtml(ed.extra)}</div>` : ''}
          </div>
        `;
      });

      let skillsHTML = '';
      data.skills.forEach(s => {
        skillsHTML += `<div class="skill-badge">${escapeHtml(s)}</div>`;
      });

      let projectsHTML = '';
      data.projects.forEach(p => {
        if (!p.name) return;
        projectsHTML += `
          <div class="item">
            <div style="font-weight:600;">${escapeHtml(p.name)}</div>
            <div style="margin-top:4px;">${escapeHtml(p.description)}</div>
            ${p.link ? `<div style="margin-top:4px;"><a href="${escapeHtml(p.link)}" target="_blank">${escapeHtml(p.link)}</a></div>` : ''}
          </div>
        `;
      });

      return `
      <div class="resume">
        <div class="resume-header">
          <div class="name-block">
            <h1>${escapeHtml(data.profile.fullName || '–í–∞—à–µ –∏–º—è')}</h1>
            <div class="title">${escapeHtml(data.profile.title || '')}</div>
          </div>
          <div class="contact">
            <div>${escapeHtml(data.profile.email || '')}</div>
            <div>${escapeHtml(data.profile.phone || '')}</div>
          </div>
        </div>

        ${data.summary ? `
          <div style="margin-top:18px;">
            <div class="section-title">
              <div class="line"></div><div>–û —Å–µ–±–µ</div>
            </div>
            <div class="item">${escapeHtml(data.summary)}</div>
          </div>` : ''}

        ${experienceHTML ? `
          <div>
            <div class="section-title">
              <div class="line"></div><div>–û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã</div>
            </div>
            ${experienceHTML}
          </div>` : ''}

        ${educationHTML ? `
          <div>
            <div class="section-title">
              <div class="line"></div><div>–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ</div>
            </div>
            ${educationHTML}
          </div>` : ''}

        ${skillsHTML ? `
          <div>
            <div class="section-title">
              <div class="line"></div><div>–ù–∞–≤—ã–∫–∏</div>
            </div>
            <div style="display:flex; flex-wrap:wrap; gap:6px;">
              ${skillsHTML}
            </div>
          </div>` : ''}

        ${projectsHTML ? `
          <div>
            <div class="section-title">
              <div class="line"></div><div>–ü—Ä–æ–µ–∫—Ç—ã</div>
            </div>
            ${projectsHTML}
          </div>` : ''}
      </div>
      `;
    }

    // ==================== –≠–∫—Å–ø–æ—Ä—Ç –≤ PDF ====================
    async function exportPDF() {
      // –ò—Å–ø–æ–ª—å–∑—É–µ–º html2canvas-like —Ä–µ–Ω–¥–µ—Ä: —É–ø—Ä–æ—â—ë–Ω–Ω–æ –±–µ—Ä—ë–º —Ç–µ–∫—Å—Ç–æ–≤—É—é –≤–µ—Ä—Å–∏—é
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({ unit: 'pt', format: 'a4' });
      const margin = 40;
      let y = 40;

      // –ó–∞–≥–æ–ª–æ–≤–æ–∫
      doc.setFontSize(22);
      doc.setFont('helvetica', 'bold');
      doc.text(state.profile.fullName || '', margin, y);
      y += 28;
      doc.setFontSize(12);
      doc.setFont('helvetica', 'normal');
      doc.text(state.profile.title || '', margin, y);
      y += 18;
      doc.text(`${state.profile.email || ''} | ${state.profile.phone || ''}`, margin, y);
      y += 28;

      if (state.summary) {
        doc.setFontSize(14);
        doc.setFont('helvetica', 'bold');
        doc.text('–û —Å–µ–±–µ', margin, y);
        y += 18;
        doc.setFontSize(11);
        doc.setFont('helvetica', 'normal');
        const split = doc.splitTextToSize(state.summary, 500);
        doc.text(split, margin, y);
        y += split.length * 14 + 10;
      }

      function safePeriod(start, end) {
        if (!start && !end) return '';
        const opts = { year: 'numeric', month: 'short' };
        try {
          const s = start ? new Date(start + '-01').toLocaleDateString('ru-RU', opts) : '';
          const e = end ? new Date(end + '-01').toLocaleDateString('ru-RU', opts) : '–Ω–∞—Å—Ç–æ—è—â–µ–µ –≤—Ä–µ–º—è';
          return `${s} ‚Äî ${e}`;
        } catch { return `${start || ''} ‚Äî ${end || ''}`; }
      }

      if (state.experience.length) {
        doc.setFontSize(14);
        doc.setFont('helvetica', 'bold');
        doc.text('–û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã', margin, y);
        y += 18;
        state.experience.forEach(exp => {
          if (y > 750) {
            doc.addPage();
            y = 40;
          }
          doc.setFontSize(12);
          doc.setFont('helvetica', 'bold');
          const titleLine = `${exp.position || ''}${exp.position && exp.company ? ' –≤ ' : ''}${exp.company || ''}`;
          doc.text(titleLine, margin, y);
          doc.setFontSize(10);
          doc.setFont('helvetica', 'normal');
          doc.text(safePeriod(exp.start, exp.end), margin, y + 14);
          if (exp.description) {
            const splitDesc = doc.splitTextToSize(exp.description, 500);
            doc.text(splitDesc, margin, y + 30);
            y += 30 + splitDesc.length * 12;
          } else {
            y += 40;
          }
          y += 6;
        });
      }

      if (state.education.length) {
        if (y > 700) { doc.addPage(); y = 40; }
        doc.setFontSize(14);
        doc.setFont('helvetica', 'bold');
        doc.text('–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ', margin, y);
        y += 18;
        state.education.forEach(ed => {
          if (y > 750) {
            doc.addPage(); y = 40;
          }
          doc.setFontSize(12);
          doc.setFont('helvetica', 'bold');
          const main = `${ed.degree || ''} ‚Äî ${ed.school || ''}`;
          doc.text(main, margin, y);
          doc.setFontSize(10);
          doc.setFont('helvetica', 'normal');
          doc.text(safePeriod(ed.start, ed.end), margin, y + 14);
          if (ed.extra) {
            doc.text(ed.extra, margin, y + 30);
            y += 30;
          }
          y += 30;
        });
      }

      if (state.skills.length) {
        if (y > 700) { doc.addPage(); y = 40; }
        doc.setFontSize(14);
        doc.setFont('helvetica', 'bold');
        doc.text('–ù–∞–≤—ã–∫–∏', margin, y);
        y += 18;
        doc.setFontSize(10);
        doc.setFont('helvetica', 'normal');
        doc.text(state.skills.join(', '), margin, y);
        y += 30;
      }

      if (state.projects.length) {
        if (y > 700) { doc.addPage(); y = 40; }
        doc.setFontSize(14);
        doc.setFont('helvetica', 'bold');
        doc.text('–ü—Ä–æ–µ–∫—Ç—ã', margin, y);
        y += 18;
        state.projects.forEach(p => {
          if (y > 750) { doc.addPage(); y = 40; }
          doc.setFontSize(12);
          doc.setFont('helvetica', 'bold');
          doc.text(p.name || '', margin, y);
          y += 14;
          doc.setFontSize(10);
          doc.setFont('helvetica', 'normal');
          if (p.description) {
            const split = doc.splitTextToSize(p.description, 500);
            doc.text(split, margin, y);
            y += split.length * 12;
          }
          if (p.link) {
            doc.text(p.link, margin, y);
            y += 14;
          }
          y += 10;
        });
      }

      doc.save(`${(state.profile.fullName || 'resume').replace(/\s+/g,'_')}.pdf`);
    }

    // ==================== –°—Ç–µ–ø–ø–µ—Ä (–≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞) ====================
    function updateStepper() {
      const total = 5;
      let filled = 0;
      if (state.profile.fullName || state.profile.title || state.profile.email || state.profile.phone) filled++;
      if (state.summary) filled++;
      if (state.experience.length) filled++;
      if (state.education.length || state.skills.length) filled++;
      if (state.projects.length) filled++;
      document.querySelectorAll('.step-dot').forEach((dot, i) => {
        dot.classList.toggle('active', i < filled);
      });
    }

    // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
    setInterval(() => {
      updateStepper();
    }, 800);

    // –ó–∞–ø—É—Å–∫
    init();
  </script>
</body>
</html>
